---
title: "CS 329E Data Visualization R Project 1"
author: "Syairah Ridzuan, Madeline Packard, Arthur DeVitalis"
date: "February 3, 2015"
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.


### There are four kinds of data frames pulled from the orders schema

```{r}

require(RCurl)

# create data frame
customer_df <- data.frame(eval(parse(text=substring(getURL(URLencode('http://129.152.144.84:5001/rest/native/?query="SELECT * FROM customers"'), httpheader=c(DB='jdbc:oracle:thin:@129.152.144.84:1521/PDB1.usuniversi01134.oraclecloud.internal', USER='DV_ORDERS', PASS='orcl', MODE='native_mode', MODEL='model', returnFor = 'R', returnDimensions = 'False'), verbose = TRUE), 1, 2^31-1))))

items_df <- data.frame(eval(parse(text=substring(getURL(URLencode('http://129.152.144.84:5001/rest/native/?query="SELECT * FROM items"'), httpheader=c(DB='jdbc:oracle:thin:@129.152.144.84:1521/PDB1.usuniversi01134.oraclecloud.internal', USER='DV_ORDERS', PASS='orcl', MODE='native_mode', MODEL='model', returnFor = 'R', returnDimensions = 'False'), verbose = TRUE), 1, 2^31-1))))

order_details_df <- data.frame(eval(parse(text=substring(getURL(URLencode('http://129.152.144.84:5001/rest/native/?query="SELECT * FROM order_details"'), httpheader=c(DB='jdbc:oracle:thin:@129.152.144.84:1521/PDB1.usuniversi01134.oraclecloud.internal', USER='DV_ORDERS', PASS='orcl', MODE='native_mode', MODEL='model', returnFor = 'R', returnDimensions = 'False'), verbose = TRUE), 1, 2^31-1))))

orders_df <- data.frame(eval(parse(text=substring(getURL(URLencode('http://129.152.144.84:5001/rest/native/?query="SELECT * FROM orders"'), httpheader=c(DB='jdbc:oracle:thin:@129.152.144.84:1521/PDB1.usuniversi01134.oraclecloud.internal', USER='DV_ORDERS', PASS='orcl', MODE='native_mode', MODEL='model', returnFor = 'R', returnDimensions = 'False'), verbose = TRUE), 1, 2^31-1))))


head(customer_df)

head(items_df)

head(order_details_df)

head(orders_df)


```

### Here are some interesting visual representations that we yield from each data frame
```{r, echo = FALSE}

require(ggplot2)
#customer_df  - state-city relationship - Fairfield exists in IA and NJ
ggplot(customer_df, aes(x = CUSTOMER_STATE, y = CUSTOMER_CITY)) + geom_point() 
```

The existence of Fairfield in IA and NJ exemplifies the possibility that city and state has many-to-many relationship.


```{r, echo = FALSE}
#items_df

ggplot(items_df, aes(x = ARTIST, y = UNIT_PRICE)) + geom_point()
```

It can be inferred from the graph above that the competitive unit price for artists to sell their albums falls between 16 and 17 dollars per album.


```{r, echo = FALSE}
#order_details_df 
#count of each items ordered (name of items are unknown)
ggplot(order_details_df) + geom_histogram(aes(x = ITEM_ID), binwidth = 1, colour = "purple", fill = "white" )
```

This histograms indicates the popularity of each item sold with the quantity shown on y-axis. It can be inferred that the album with item_id 1 is the highest selling product.

```{r, echo = FALSE}
#orders_df 
#no need aes(color=CUSTOMER_ID ) because each customer_id is unique, non-continuous
ggplot(orders_df, aes(x = CUSTOMER_ID, y = ORDER_ID)) + geom_point() + facet_wrap(~CUSTOMER_ID)
```

This graph indicates the customer loyalty based on the frequency of each customer purchasing albums from this company.



## Reproducing the graphs displayed in step 10:

First, we need to combine all the data frames above. This is done by inserting the following SQL command 'select * from orders o join customers c on o.customer_id = c.customer_id join order_details d on o.order_id = d.order_id join items i on d.item_id = i.item_id' inside RestfulREL call. The resulting call is as follows:

```{r, warning=FALSE}
# Create a data frame for the entire data set.
combine_df <- data.frame(eval(parse(text=substring(getURL(URLencode('http://129.152.144.84:5001/rest/native/?query="select * from orders o join customers c on o.customer_id = c.customer_id join order_details d on o.order_id = d.order_id join items i on d.item_id = i.item_id"'), httpheader=c(DB='jdbc:oracle:thin:@129.152.144.84:1521/PDB1.usuniversi01134.oraclecloud.internal', USER='DV_ORDERS', PASS='orcl', MODE='native_mode', MODEL='model', returnFor = 'R', returnDimensions = 'False'), verbose = TRUE), 1, 2^31-1))))
```

Create a subset of `combine_df` containing the following vectors: ORDER DATE, SHIPPED DATE, UNIT PRICE, CUSTOMER_STATE
```{r, warning=FALSE}
#create new subset   ORDER_DATE - SHIPPED_DATE - UNIT_PRICE - CUSTOMER_STATE
shipped_byunitprice <- combine_df[,c("ORDER_DATE", "SHIPPED_DATE", "UNIT_PRICE", "CUSTOMER_STATE")]
```


```{r, warning=FALSE}
#view the new data frame created from the subset
head(shipped_byunitprice)
```

Notice that in shipped_byunitprice, ORDER DATE and SHIPPED DATE contain details that we do not need to create the graph, which are the time of order as well as the time that the item got shipped. In order to eliminate these details, reformat ORDER DATE and SHIPPED DATE as follows:

```{r, warning=FALSE}
shipped_byunitprice$ORDER_DATE <- as.Date(shipped_byunitprice$ORDER_DATE, format="%Y-%m-%d")
shipped_byunitprice$SHIPPED_DATE <- as.Date(shipped_byunitprice$SHIPPED_DATE, format="%Y-%m-%d")
```

Make sure that the class of UNIT_PRICE is factor. The following converts it into the type factor.
```{r, warning=FALSE}
shipped_byunitprice$UNIT_PRICE <- as.factor(shipped_byunitprice$UNIT_PRICE)
```

Create a visual represetation using `ggplot2` package:
```{r, warning=FALSE}
ggplot(shipped_byunitprice, aes(x=ORDER_DATE, y= SHIPPED_DATE)) + geom_point(aes(color=UNIT_PRICE)) + facet_wrap(~CUSTOMER_STATE)
```

Repeat the steps to produce the latter two graphs.

```{r, warning=FALSE, echo=FALSE}
#create new subset   ORDER_DATE - SHIPPED_DATE - TITLE - CUSTOMER_STATE
shipped_bytitle <- combine_df[,c("ORDER_DATE", "SHIPPED_DATE", "TITLE", "CUSTOMER_STATE")]
shipped_bytitle$ORDER_DATE <- as.Date(shipped_bytitle$ORDER_DATE, format="%Y-%m-%d")
shipped_bytitle$SHIPPED_DATE <- as.Date(shipped_bytitle$SHIPPED_DATE, format="%Y-%m-%d")

ggplot(shipped_bytitle, aes(x=ORDER_DATE, y= SHIPPED_DATE)) + geom_point(aes(color=TITLE)) + facet_wrap(~CUSTOMER_STATE)



#create new subset   ORDER_DATE - SHIPPED_DATE - ARTIST - CUSTOMER_STATE
shipped_byartist <- combine_df[,c("ORDER_DATE", "SHIPPED_DATE", "ARTIST", "CUSTOMER_STATE")]
shipped_byartist$ORDER_DATE <- as.Date(shipped_byartist$ORDER_DATE, format="%Y-%m-%d")
shipped_byartist$SHIPPED_DATE <- as.Date(shipped_byartist$SHIPPED_DATE, format="%Y-%m-%d")
class(shipped_byartist$ARTIST)

ggplot(shipped_byartist, aes(x=ORDER_DATE, y= SHIPPED_DATE)) + geom_point(aes(color=ARTIST)) + facet_wrap(~CUSTOMER_STATE)


```

VOILA!



Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
